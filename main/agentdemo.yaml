##only support 3 level config info
#config fo agent
motan-agent:
  port: 9981 # agent serve port.
  eport: 9982 # service export port when as a reverse proxy
  mport: 8002 # agent manage port
  log_dir: "stdout"
  registry: "direct-registry" # registry id for registering agent info
  application: "agent-test" # agent identify. for agent command notify and so on

#config of registries
motan-registry:
  direct-registry: # registry id 
    protocol: direct   # registry type. will get instance from extFactory.
    host: 127.0.0.1 # direct server ip in single ip. if has host, address will disable.
    port: 9982 #direct server port
    # address: "10.210.21.1:8002,10.210.21.2:8002" # direct server in multi ip

  zk-registry:
    protocol: zookeeper
    host: 127.0.0.1
    port: 2181
    registrySessionTimeout: 10000
    requestTimeout: 5000

motan-service:
  test.domain:
    registry: zk-registry
    group: test.domain
    domain: test.domain
    path: test
    export: "motan2:9982"
    provider: http
    serialization: simple
    proxyAddress: 127.0.0.1:9090
#    filter: "accessLog,metric"
    requestTimeout: 2000

http-locations:
  test.domain:
    - match: /test
      type: start
      upstream: test
      script: |
        rmatch $request_uri ^(/test1/.*)
        jt L1
        ret
        L1:
        rewrite /test1/(.*) /backend/test1/$1
        ret

    - match: /test2
      type: start
      upstream: test2

    - match: /test3/*
      type: regexp
      upstream: test3

    - match: ^/(tst|2).*
      type: regexp
      upstream: test
      rewriteRules:
        # condition_type(! means not) condition regexp replacement
        - "!regexp ^/2/.*  ^/(.*) /2/$1"

http-client:
  test.domain:
    registry: zk-registry
    domain: test.domain
    group: test.domain
    preload: test
    serialization: simple
    protocol: motan2 # this is the default endpoint type,the client use motan2 transport data to remote server, but it provider a http server when as the agent

#conf of extensions. any custom config
testextconf:
  foo: xxx
  bar:
    sub1: zzz
    sub2: zzz